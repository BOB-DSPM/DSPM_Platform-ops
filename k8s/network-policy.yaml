### Network Policy for DSPM Services
# 서비스 간 통신 규칙 정의

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: dspm-network-policy
  namespace: dspm
spec:
  podSelector: {}  # dspm 네임스페이스의 모든 파드에 적용
  policyTypes:
  - Ingress
  - Egress
  
  ingress:
  # 같은 네임스페이스 내 파드들 간 통신 허용
  - from:
    - namespaceSelector:
        matchLabels:
          name: dspm
  # Ingress Controller로부터의 접근 허용
  - from:
    - namespaceSelector:
        matchLabels:
          name: ingress-nginx
  # 외부로부터의 HTTP/HTTPS 접근 허용 (필요시)
  - ports:
    - protocol: TCP
      port: 80
    - protocol: TCP
      port: 8080
    - protocol: TCP
      port: 8000
  
  egress:
  # 같은 네임스페이스 내 파드들 간 통신 허용
  - to:
    - namespaceSelector:
        matchLabels:
          name: dspm
  # DNS 해석을 위한 kube-system 접근
  - to:
    - namespaceSelector:
        matchLabels:
          name: kube-system
    ports:
    - protocol: UDP
      port: 53
  # RDS 접근을 위한 외부 통신 허용
  - to: []
    ports:
    - protocol: TCP
      port: 5432  # PostgreSQL
  # AWS API 접근을 위한 HTTPS 허용
  - to: []
    ports:
    - protocol: TCP
      port: 443  # HTTPS
    - protocol: TCP
      port: 80   # HTTP